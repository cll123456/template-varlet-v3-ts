import{L as J,f as K,g as O,h as j}from"./index.11dc6b9a.js";import{d as G,B as g,o as Q,s as X,D as I,h as _,b as h,c as m,f as y,p as V,k as i,F as E,j as D,n as R,G as S,I as L,l as Y,w as Z,U as ee,m as te,t as C,e as re,N as oe,H as ne}from"./index.3dd924bd.js";const T=e=>typeof e=="string",ae=e=>typeof e=="boolean",F=e=>typeof e=="number",ie=e=>Array.isArray(e),se=e=>T(e)&&e.endsWith("rem"),le=e=>T(e)&&e.endsWith("px")||F(e),ue=e=>T(e)&&e.endsWith("vw"),ce=e=>T(e)&&e.endsWith("vh"),de=e=>{if(F(e))return e;if(le(e))return+e.replace("px","");if(ue(e))return+e.replace("vw","")*window.innerWidth/100;if(ce(e))return+e.replace("vh","")*window.innerHeight/100;if(se(e)){const r=+e.replace("rem",""),c=window.getComputedStyle(document.documentElement).fontSize;return r*parseFloat(c)}return T(e)?fe(e):0},fe=e=>e==null?0:T(e)?(e=parseFloat(e),e=Number.isNaN(e)?0:e,e):ae(e)?Number(e):e,B=(e,r)=>e==null?r:e;function ge(e){const r=`var-${e}`;return{n:u=>u?u.startsWith("--")?`${r}${u}`:`${r}__${u}`:r,classes:(...u)=>u.map(p=>{if(ie(p)){const[n,s,v=null]=p;return n?s:v}return p})}}var he={loading:{type:Boolean,default:!1},immediateCheck:{type:Boolean,default:!0},finished:{type:Boolean,default:!1},error:{type:Boolean,default:!1},offset:{type:[String,Number],default:0},loadingText:{type:String},finishedText:{type:String},errorText:{type:String},onLoad:{type:Function},"onUpdate:loading":{type:Function},"onUpdate:error":{type:Function},useVirtual:{type:Boolean,required:!0,default:!1},dataList:{type:Array,default:()=>[]},itemDefaultHeight:{type:Number,default:50},showCounts:{type:Number,default:20}};const pe=["data-key"],me=G({__name:"index",props:he,setup(e){const r=e,{n:c}=ge("list"),k=J.pack.value,u=g(r.itemDefaultHeight),p=g(r.showCounts),n=g([]),s=g([]),v=g(0),d=g(0),H=g(null);let w=g(null);const M=()=>{r["onUpdate:error"]&&r["onUpdate:error"](!1),r["onUpdate:loading"]&&r["onUpdate:loading"](!0),r.onLoad&&r.onLoad()},U=()=>{var a;const t=w.value===null?window.innerHeight:(a=w.value)==null?void 0:a.getBoundingClientRect().bottom,{bottom:o}=H.value.getBoundingClientRect();return Math.floor(o)-de(r.offset)<=t};Q(()=>{r.useVirtual&&(N(),z(),r.immediateCheck&&$())}),X(r.dataList,t=>{t.length>0&&r.useVirtual&&N()});const z=()=>{const t=document.querySelector(".InfiniteScrollContainer");t&&(v.value=t==null?void 0:t.getBoundingClientRect().height)},N=async()=>{if(r.dataList.length>0){const t=n.value.length;n.value=JSON.parse(JSON.stringify([...n.value,...r.dataList.slice(t,r.dataList.length)]));for(let o=t;o<n.value.length;o++){const a=n.value[o];a.curRowId=o,a.hasRenderDom=!1,a.curRowKey=o,a.curRowMarginTop=o===0?0:n.value[o-1].curRowMarginTop+n.value[o-1].curRowHeight,a.curRowHeight=u.value}s.value.length===0&&(s.value=n.value.slice(0,p.value)),x(),I(()=>{s.value.forEach(o=>{b(o)})})}},b=t=>{if(!t.hasRenderDom){let o=t.curRowId,a=document.getElementsByClassName("InfiniteScrollItem"+o)[0].getBoundingClientRect().height;n.value[o].curRowHeight=a,n.value[o].hasRenderDom=!0;for(let f=0;f<n.value.length;f++)f>0&&(n.value[f].curRowMarginTop=n.value[f-1].curRowMarginTop+n.value[f-1].curRowHeight)}},A=_(()=>{let t=0;return n.value.forEach(o=>{t+=o.curRowHeight}),t}),$=async()=>{const{loading:t,finished:o,error:a}=r;t||(!t&&!o&&!a&&U()?M():w.value&&Math.abs(w.value.scrollTop-d.value)>u.value&&(d.value=w.value.scrollTop,x()))},W=t=>t.curRowMarginTop<d.value&&t.curRowMarginTop+t.curRowHeight>d.value+v.value||t.curRowMarginTop>d.value&&t.curRowMarginTop<d.value+v.value?!0:t.curRowMarginTop+t.curRowHeight>d.value-300&&t.curRowMarginTop+t.curRowHeight<d.value+v.value+300,P=_(()=>s.value[0]?s.value[0].curRowMarginTop:0),x=()=>{for(let t=0;t<n.value.length;t++)if(W(n.value[t])){let o=t+p.value;s.value=n.value.slice(t,Math.min(o,n.value.length)),I(()=>{s.value.forEach(a=>{b(a)})});break}};return(t,o)=>{const a=O,f=K,q=j;return t.useVirtual?(h(),m("div",{key:0,ref_key:"scrollerRef",ref:w,class:"InfiniteScrollContainer h-full relative overflow-y-auto overflow-x-hidden",onScroll:$},[y("div",{class:"absolute top-0 left-0 right-0",style:V(`height: ${i(A)}px`)},null,4),y("div",{class:"relative flex flex-col flex-nowrap flex-shrink-0",style:V({transform:`translate3d(0,${i(P)}px,0)`})},[(h(!0),m(E,null,D(s.value,l=>(h(),m("div",{key:l.curRowId+"_"+l.curRowKey,"data-key":l.curRowId,class:R(`${"InfiniteScrollItem"+l.curRowId} w-full flex-shrink-0`)},[S(t.$slots,"default",{item:l,index:l.curRowId})],10,pe))),128)),t.loading?S(t.$slots,"loading",{key:0},()=>[y("div",{class:R(i(c)("loading"))},[y("div",{class:R(i(c)("loading-text"))},C(i(B)(t.loadingText,i(k).listLoadingText)),3),re(a,{size:"mini",radius:10})],2)]):L("",!0),t.finished?S(t.$slots,"finished",{key:1},()=>[y("div",{class:R(i(c)("finished"))},C(i(B)(t.finishedText,i(k).listFinishedText)),3)]):L("",!0),t.error?S(t.$slots,"error",{key:2},()=>[oe((h(),m("div",{class:R(i(c)("error")),onClick:M},[ne(C(i(B)(t.errorText,i(k).listErrorText)),1)],2)),[[q]])]):L("",!0),y("div",{ref_key:"detectorEl",ref:H,class:R(i(c)("detector"))},null,2)],4)],544)):(h(),Y(f,ee(te({key:1},r)),{default:Z(()=>[(h(!0),m(E,null,D(t.dataList,l=>(h(),m("div",{key:l.id},[S(t.$slots,"default",{item:l,index:l.id})]))),128))]),_:3},16))}}});export{me as _};
